<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/plantilla/plantillaBasica.xhtml">
	<ui:define name="title">MODULO VENTAS</ui:define>
	<ui:define name="content">
		<div class="container-fluid">

			<h:form id="formConsultaVenta">
				<p:fieldset legend="CONSULTA VENTA">
					<div class="row justify-content-md-center">
						<div class="col-12 col-sm-8 col-md-6">
							<p:tabView dynamic="true" cache="true" id="tabVenta"
								effect="fade">
								<p:ajax event="tabChange"
									update=":formConsultaVenta:msgRangoFecha" />

								<p:tab title="Consulta por fecha">
									<p:calendar value="#{ventaConsultaBean.atributoUtil.fecha}"
										pattern="dd-MM-yyyy" id="fecha" locale="es">
										<f:ajax event="dateSelect" execute="@this"
											render=":formConsultaVenta:tabla :formConsultaVenta:acumulado"
											listener="#{ventaConsultaBean.listarVentaXFecha}" />
									</p:calendar>
								</p:tab>
								<p:tab title="Consulta por rango de fecha">
									<p:calendar value="#{ventaConsultaBean.atributoUtil.fechaIni}"
										pattern="dd-MM-yyyy" pages="3" locale="es">
										<f:ajax event="dateSelect" execute="@this" render="ffinal"
											listener="#{ventaConsultaBean.listarVentaRangoFecha}" />
									</p:calendar>
									<p:calendar id="ffinal"
										value="#{ventaConsultaBean.atributoUtil.fechaFin}"
										pattern="dd-MM-yyyy" pages="3" locale="es">
										<f:ajax event="dateSelect" execute="@this"
											render=":formConsultaVenta:tabla :formConsultaVenta:msgRangoFecha :formConsultaVenta:acumulado"
											listener="#{ventaConsultaBean.listarVentaRangoFecha}" />
									</p:calendar>
								</p:tab>
								<p:tab title="Consulta por cliente">
									<p:inputText
										value="#{ventaConsultaBean.atributoUtil.cliente.nombre}"
										id="nombre" placeholder="Ingrese un cliente">
										<f:ajax event="keyup" execute="@this"
											render=":formConsultaVenta:tabla :formConsultaVenta:acumulado"
											listener="#{ventaConsultaBean.listarVentaXCliente}" />
									</p:inputText>
								</p:tab>
							</p:tabView>
							<p:messages for="mensajeRangoFecha" id="msgRangoFecha" />
						</div>

						<div class="col-12 col-sm-4 col-md-2">
							<p:panelGrid columns="2" id="acumulado">
								<p:outputLabel value="Monto contado" for="acumuladoCo" />
								<p:outputLabel value="#{ventaConsultaBean.acumuladoContado}"
									id="acumuladoCo" />
								<p:outputLabel value="Monto deposito" for="acumuladoD" />
								<p:outputLabel value="#{ventaConsultaBean.acumuladoDeposito}"
									id="acumuladoD" />
								<p:outputLabel value="Monto credito" for="acumuladoCr" />
								<p:outputLabel value="#{ventaConsultaBean.acumuladoCredito}"
									id="acumuladoCr" />
							</p:panelGrid>

						</div>

					</div>
					<br />

					<p:dataTable id="tabla" value="#{ventaConsultaBean.ventas}" var="t"
						emptyMessage="No existe ventas" reflow="true"
						paginatorTemplate="{Exportar}">

						<f:facet name="{Exportar}">
							<h:commandLink styleClass="btn btn-success btn-sm"
								title="Exportar">
								<i class="fa fa-fw fa-file-excel-o"></i>
								<p:outputLabel value=" Exportar" />
								<p:dataExporter type="xls" target="tabla" fileName="ventas" />
							</h:commandLink>
						</f:facet>

						<p:column width="5%" headerText="NRO.">
							<h:outputText value="#{t.numComprobante % 10000000}" />
						</p:column>
						<p:column width="5%" headerText="CDP">
							<h:outputText value="#{t.comprobante.descripcion}" />
						</p:column>
						<p:column width="8%" headerText="FECHA">
							<h:outputText value="#{t.fecha}">
								<f:convertDateTime pattern="dd - MM - yyyy" />
							</h:outputText>
						</p:column>
						<p:column width="5%" headerText="HORA" exportable="false">
							<h:outputText value="#{t.hora}">
								<f:convertDateTime pattern="hh - mm - ss" />
							</h:outputText>
						</p:column>
						<p:column headerText="CLIENTE">
							<h:outputText value="#{t.cliente.nombre}" />
						</p:column>
						<p:column headerText="DIRECCION" exportable="false">
							<h:outputText value="#{t.cliente.direccion}" />
						</p:column>
						<p:column width="8%" headerText="RUC">
							<h:outputText value="#{t.cliente.nroDocumento}" />
						</p:column>
						<p:column width="8%" headerText="MONTO">
							<h:outputText value="#{t.monto}" />
						</p:column>
						<p:column width="5%" headerText="ESTADO">
							<h:outputText value="#{t.estado.descripcion}" />
						</p:column>
					</p:dataTable>
				</p:fieldset>
			</h:form>
		</div>

	</ui:define>
</ui:composition>
</html>