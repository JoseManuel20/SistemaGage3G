<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/WEB-INF/plantilla/plantillaBasica.xhtml">
	<ui:define name="title">MODULO ALMACEN</ui:define>
	<ui:define name="content">
		<div class="container-fluid">
			<p:fieldset legend="KARDEX POR ALMACEN">
				<h:form id="formMovimientos">
					<div class="row">

						<div class="col-xs-12 col-sm-6 col-md-6 col-md-offset-1">
							<p:tabView dynamic="true" cache="true" style="width:80%">
								<p:ajax event="tabChange"
									update=":formMovimientos:msgRangoFecha" />

								<p:tab title="Fecha">
									<p:calendar value="#{kardexConsultaBean.fecha}"
										pattern="dd-MM-yyyy" id="fecha">
										<p:ajax event="dateSelect" update=":formMovimientos:tabla"
											listener="#{kardexConsultaBean.listarMovimientoXFecha}" />
									</p:calendar>
								</p:tab>

								<p:tab title="Rango de fecha">
									<p:calendar value="#{kardexConsultaBean.fechaIni}"
										pattern="dd-MM-yyyy" pages="3" locale="es">
										<p:ajax event="dateSelect" update="ffinal"
											listener="#{kardexConsultaBean.listarMovimientoXRangoFecha}" />
									</p:calendar>

									<p:calendar id="ffinal" value="#{kardexConsultaBean.fechaFin}"
										pattern="dd-MM-yyyy" pages="3" locale="es">
										<p:ajax event="dateSelect"
											update=":formMovimientos:tabla :formMovimientos:msgRangoFecha"
											listener="#{kardexConsultaBean.listarMovimientoXRangoFecha}" />
									</p:calendar>
								</p:tab>
							</p:tabView>
							<p:messages for="mensajeRangoFecha" id="msgRangoFecha" />
						</div>
						<div class="col-xs-12 col-sm-3 col-md-2 col-md-offset-0">
							<h:commandLink styleClass="#{r.celeste}" value="Exportar ">
								<p:graphicImage value="/imagenes/excel.png" width="24" />
								<p:dataExporter type="xls" target="tabla" fileName="movimientos" />
							</h:commandLink>
						</div>
					</div>
					<br />
					<p:dataTable id="tabla" value="#{kardexConsultaBean.movimientos}"
						var="t" emptyMessage="No hay movimientos registrados"
						reflow="true" paginator="true" rows="15">
						<p:column headerText="ALMACEN">
							<h:outputText value="#{t.detalleAlmacen.almacen.descripcion}" />
						</p:column>
						<p:column width="8%" headerText="FECHA">
							<h:outputText value="#{t.movimiento.fecha}">
								<f:convertDateTime pattern="dd - MM - yyyy" />
							</h:outputText>
						</p:column>
						<p:column headerText="HORA" exportable="false">
							<h:outputText value="#{t.movimiento.hora}">
								<f:convertDateTime pattern="hh - mm - ss" />
							</h:outputText>
						</p:column>
						<p:column headerText="NUMERO">
							<h:outputText value="#{t.movimiento.numComprobante % 10000000}" />
						</p:column>
						<p:column headerText="CDP">
							<h:outputText value="#{t.movimiento.comprobante.descripcion}" />
						</p:column>
						<p:column width="40%" headerText="PRODUCTO">
							<h:outputText value="#{t.detalleAlmacen.producto.descripcion}" />
						</p:column>
						<p:column headerText="TIPO">
							<h:outputText
								value="#{t.detalleAlmacen.producto.tipo.descripcion}" />
						</p:column>
						
						<p:column exportable="false" headerText="ENTRADA">
							<h:outputText value="#{t.movimiento.tipoMovimiento.codMovimiento eq 2 ? t.cantidad : 0}"/>
						</p:column>
						<p:column exportable="false" headerText="SALIDA">
							<h:outputText value="#{t.movimiento.tipoMovimiento.codMovimiento eq 1 ? t.cantidad : 0}"/>
						</p:column>
						<p:column headerText="SALDO">
							<h:outputText value="#{t.detalleAlmacen.existencia}" />
						</p:column>
						<p:column exportable="false" headerText="OBS">
							<h:outputLink value="#" id="obs">
								<h:outputText value="OBS" />
							</h:outputLink>
							<p:tooltip id="toolTipFocus" for="obs" trackMouse="true"
								styleClass="lead" hideEffect="explode"
								value="#{t.movimiento.observacion}" />
						</p:column>
					</p:dataTable>

				</h:form>
			</p:fieldset>
		</div>
	</ui:define>
</ui:composition>
</html>